<!--&lt;!&ndash;<!DOCTYPE html>&ndash;&gt;-->

<!--&lt;!&ndash;&lt;!&ndash;WhatIsThis:&ndash;&gt;-->

<!--&lt;!&ndash;    non-Chrome extension driver&ndash;&gt;-->

<!--&lt;!&ndash;    pure html/js driver when input can be pasted.&ndash;&gt;-->
<!--&lt;!&ndash;    should work on ipad and iphone&ndash;&gt;-->

<!--&lt;!&ndash;** faw106 built from faw106&ndash;&gt;-->

<!--&lt;!&ndash;&ndash;&gt;&ndash;&gt;-->

<!--&lt;!&ndash;<html lang="en">&ndash;&gt;-->
<!--&lt;!&ndash;<head>&ndash;&gt;-->
<!--&lt;!&ndash;  <meta charset="UTF-8">&ndash;&gt;-->
<!--&lt;!&ndash;  <meta name="viewport" content="width=device-width, initial-scale=1.0">&ndash;&gt;-->
<!--&lt;!&ndash;  <title>Movie Magic - faw109</title>&ndash;&gt;-->
<!--&lt;!&ndash;  <style>&ndash;&gt;-->
<!--&lt;!&ndash;    body {&ndash;&gt;-->
<!--&lt;!&ndash;      font-family: Arial, sans-serif;&ndash;&gt;-->
<!--&lt;!&ndash;      margin: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;      width: 400px;&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->
<!--&lt;!&ndash;    .hidden {&ndash;&gt;-->
<!--&lt;!&ndash;      display: none;&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->
<!--&lt;!&ndash;    #queryInput {&ndash;&gt;-->
<!--&lt;!&ndash;      width: calc(100% - 20px);&ndash;&gt;-->
<!--&lt;!&ndash;      padding: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;      font-size: 14px;&ndash;&gt;-->
<!--&lt;!&ndash;      margin-bottom: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->
<!--&lt;!&ndash;    #submitQuery {&ndash;&gt;-->
<!--&lt;!&ndash;      margin-bottom: 20px;&ndash;&gt;-->
<!--&lt;!&ndash;      padding: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;      background-color: #0078d7;&ndash;&gt;-->
<!--&lt;!&ndash;      color: white;&ndash;&gt;-->
<!--&lt;!&ndash;      border: none;&ndash;&gt;-->
<!--&lt;!&ndash;      font-size: 14px;&ndash;&gt;-->
<!--&lt;!&ndash;      cursor: pointer;&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->
<!--&lt;!&ndash;    #submitQuery:hover {&ndash;&gt;-->
<!--&lt;!&ndash;      background-color: #005a9e;&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->
<!--&lt;!&ndash;    .movie-item {&ndash;&gt;-->
<!--&lt;!&ndash;      margin-bottom: 5px;&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->
<!--&lt;!&ndash;    button {&ndash;&gt;-->
<!--&lt;!&ndash;      margin-top: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->
<!--&lt;!&ndash;    .radio-group {&ndash;&gt;-->
<!--&lt;!&ndash;      margin-bottom: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->
<!--&lt;!&ndash;    .radio-group label {&ndash;&gt;-->
<!--&lt;!&ndash;      margin-right: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->
<!--&lt;!&ndash;  </style>&ndash;&gt;-->
<!--&lt;!&ndash;</head>&ndash;&gt;-->
<!--&lt;!&ndash;<body>&ndash;&gt;-->
<!--&lt;!&ndash;<h3 id="popupTitle">Movie Magic 0.93</h3>&ndash;&gt;-->
<!--&lt;!&ndash;<br>&ndash;&gt;-->
<!--&lt;!&ndash;<button id="configureButton">Configure</button>&ndash;&gt;-->

<!--&lt;!&ndash;<div class="radio-group">&ndash;&gt;-->
<!--&lt;!&ndash;  <label><input type="radio" name="queryType" value="movies" checked> Movies</label>&ndash;&gt;-->
<!--&lt;!&ndash;  <label><input type="radio" name="queryType" value="actors"> Actors</label>&ndash;&gt;-->
<!--&lt;!&ndash;  <label><input type="radio" name="queryType" value="other"> Other</label>&ndash;&gt;-->
<!--&lt;!&ndash;</div>&ndash;&gt;-->

<!--&lt;!&ndash;<div id="inputContainer">&ndash;&gt;-->
<!--&lt;!&ndash;  <input id="queryInput" type="text" placeholder="Enter text here..." />&ndash;&gt;-->
<!--&lt;!&ndash;  <button id="submitQuery">Search</button>&ndash;&gt;-->
<!--&lt;!&ndash;</div>&ndash;&gt;-->

<!--&lt;!&ndash;<div id="moviesList"></div>&ndash;&gt;-->
<!--&lt;!&ndash;<div class="spacer"></div>&ndash;&gt;-->
<!--&lt;!&ndash;<br>&ndash;&gt;-->
<!--&lt;!&ndash;<button id="getMoreInfo" class="hidden">Get More Info</button>&ndash;&gt;-->
<!--&lt;!&ndash;<button id="setAll">Set All</button> &lt;!&ndash; Added Set All Button &ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;<button id="clearAll">Clear All</button> &lt;!&ndash; Added Clear All Button &ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;<button id="openMovieTable">Open Movie Table</button>&ndash;&gt;-->
<!--&lt;!&ndash;<button id="openActorTable">Open Actor Table</button>&ndash;&gt;-->
<!--&lt;!&ndash;</body>&ndash;&gt;-->

<!--&lt;!&ndash;<script src="js/util1.js"></script>&ndash;&gt;-->


<!--&lt;!&ndash;<script>&ndash;&gt;-->
<!--&lt;!&ndash;  document.addEventListener("DOMContentLoaded", () => {&ndash;&gt;-->
<!--&lt;!&ndash;    const queryInput = document.getElementById("queryInput");&ndash;&gt;-->
<!--&lt;!&ndash;    const submitQuery = document.getElementById("submitQuery");&ndash;&gt;-->
<!--&lt;!&ndash;    const moviesList = document.getElementById("moviesList");&ndash;&gt;-->
<!--&lt;!&ndash;    const configureButton = document.getElementById("configureButton");&ndash;&gt;-->
<!--&lt;!&ndash;    const queryTypeRadios = document.getElementsByName("queryType");&ndash;&gt;-->

<!--&lt;!&ndash;    configureButton.addEventListener("click", () => {&ndash;&gt;-->
<!--&lt;!&ndash;      chrome.windows.create({&ndash;&gt;-->
<!--&lt;!&ndash;        url: "config.html",&ndash;&gt;-->
<!--&lt;!&ndash;        type: "popup",&ndash;&gt;-->
<!--&lt;!&ndash;        width: 350,&ndash;&gt;-->
<!--&lt;!&ndash;        height: 400&ndash;&gt;-->
<!--&lt;!&ndash;      });&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->

<!--&lt;!&ndash;    function getSelectedQueryType() {&ndash;&gt;-->
<!--&lt;!&ndash;      return [...queryTypeRadios].find(radio => radio.checked)?.value || "movies";&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->

<!--&lt;!&ndash;    async function handleSearch() {&ndash;&gt;-->
<!--&lt;!&ndash;      const userQuery = queryInput.value.trim();&ndash;&gt;-->
<!--&lt;!&ndash;      const queryType = getSelectedQueryType();&ndash;&gt;-->
<!--&lt;!&ndash;      console.log(`Query Type: ${queryType}, Query: ${userQuery}`);&ndash;&gt;-->

<!--&lt;!&ndash;      if (userQuery) {&ndash;&gt;-->
<!--&lt;!&ndash;        let results;&ndash;&gt;-->
<!--&lt;!&ndash;        try {&ndash;&gt;-->
<!--&lt;!&ndash;          results = await findTitles(userQuery, queryType);&ndash;&gt;-->
<!--&lt;!&ndash;        } catch (error) {&ndash;&gt;-->
<!--&lt;!&ndash;          alert(`Error fetching titles: ${error.message}`);&ndash;&gt;-->
<!--&lt;!&ndash;          return;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->

<!--&lt;!&ndash;        moviesList.innerHTML = ""; // Clear previous results&ndash;&gt;-->

<!--&lt;!&ndash;        if (queryType === "movies") {&ndash;&gt;-->
<!--&lt;!&ndash;          buildHtmlMovies(results, moviesList);&ndash;&gt;-->
<!--&lt;!&ndash;        } else if (queryType === "actors") {&ndash;&gt;-->
<!--&lt;!&ndash;          buildHtmlActors(results, moviesList);&ndash;&gt;-->
<!--&lt;!&ndash;        } else if (queryType === "other") {&ndash;&gt;-->
<!--&lt;!&ndash;          buildHtmlOthers(results, moviesList); // Placeholder for "Other"&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;      } else {&ndash;&gt;-->
<!--&lt;!&ndash;        alert("Please enter a valid query.");&ndash;&gt;-->
<!--&lt;!&ndash;      }&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->

<!--&lt;!&ndash;    submitQuery.addEventListener("click", handleSearch);&ndash;&gt;-->
<!--&lt;!&ndash;    queryInput.addEventListener("keydown", (event) => {&ndash;&gt;-->
<!--&lt;!&ndash;      if (event.key === "Enter") {&ndash;&gt;-->
<!--&lt;!&ndash;        handleSearch();&ndash;&gt;-->
<!--&lt;!&ndash;      }&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->
<!--&lt;!&ndash;  });&ndash;&gt;-->

<!--&lt;!&ndash;  function buildHtmlMovies(movies, moviesList) {&ndash;&gt;-->
<!--&lt;!&ndash;    movies.forEach((movie) => {&ndash;&gt;-->
<!--&lt;!&ndash;      const item = document.createElement("div");&ndash;&gt;-->
<!--&lt;!&ndash;      item.className = "movie-item";&ndash;&gt;-->

<!--&lt;!&ndash;      const checkbox = document.createElement("input");&ndash;&gt;-->
<!--&lt;!&ndash;      checkbox.type = "checkbox";&ndash;&gt;-->
<!--&lt;!&ndash;      checkbox.value = movie;&ndash;&gt;-->

<!--&lt;!&ndash;      const link = document.createElement("a");&ndash;&gt;-->
<!--&lt;!&ndash;      link.textContent = movie;&ndash;&gt;-->
<!--&lt;!&ndash;      link.href = `https://faw987.github.io/faw106.html?title=${movie}&submit=true`;&ndash;&gt;-->
<!--&lt;!&ndash;      link.target = "_blank";&ndash;&gt;-->

<!--&lt;!&ndash;      item.appendChild(checkbox);&ndash;&gt;-->
<!--&lt;!&ndash;      item.appendChild(link);&ndash;&gt;-->
<!--&lt;!&ndash;      moviesList.appendChild(item);&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->
<!--&lt;!&ndash;  }&ndash;&gt;-->

<!--&lt;!&ndash;  function buildHtmlActors(actors, moviesList) {&ndash;&gt;-->
<!--&lt;!&ndash;    actors.forEach((actor) => {&ndash;&gt;-->
<!--&lt;!&ndash;      const item = document.createElement("div");&ndash;&gt;-->
<!--&lt;!&ndash;      item.className = "movie-item";&ndash;&gt;-->

<!--&lt;!&ndash;      const checkbox = document.createElement("input");&ndash;&gt;-->
<!--&lt;!&ndash;      checkbox.type = "checkbox";&ndash;&gt;-->
<!--&lt;!&ndash;      checkbox.value = actor;&ndash;&gt;-->

<!--&lt;!&ndash;      const link = document.createElement("a");&ndash;&gt;-->
<!--&lt;!&ndash;      link.textContent = actor;&ndash;&gt;-->
<!--&lt;!&ndash;      link.href = `https://faw987.github.io/faw108.html?actor=${actor}&submit=true`;&ndash;&gt;-->
<!--&lt;!&ndash;      link.target = "_blank";&ndash;&gt;-->

<!--&lt;!&ndash;      item.appendChild(checkbox);&ndash;&gt;-->
<!--&lt;!&ndash;      item.appendChild(link);&ndash;&gt;-->
<!--&lt;!&ndash;      moviesList.appendChild(item);&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->
<!--&lt;!&ndash;  }&ndash;&gt;-->

<!--&lt;!&ndash;  function buildHtmlOthers(others, moviesList) {&ndash;&gt;-->
<!--&lt;!&ndash;    others.forEach((other) => {&ndash;&gt;-->
<!--&lt;!&ndash;      const item = document.createElement("div");&ndash;&gt;-->
<!--&lt;!&ndash;      item.className = "movie-item";&ndash;&gt;-->

<!--&lt;!&ndash;      const text = document.createElement("span");&ndash;&gt;-->
<!--&lt;!&ndash;      text.textContent = other;&ndash;&gt;-->

<!--&lt;!&ndash;      item.appendChild(text);&ndash;&gt;-->
<!--&lt;!&ndash;      moviesList.appendChild(item);&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->
<!--&lt;!&ndash;  }&ndash;&gt;-->

<!--&lt;!&ndash;  async function findTitles(inputText, type) {&ndash;&gt;-->
<!--&lt;!&ndash;    const typePrompt = {&ndash;&gt;-->
<!--&lt;!&ndash;      movies: "Identify all movie titles",&ndash;&gt;-->
<!--&lt;!&ndash;      actors: "Identify all actor names",&ndash;&gt;-->
<!--&lt;!&ndash;      other: "Identify all other related items"&ndash;&gt;-->
<!--&lt;!&ndash;    }[type];&ndash;&gt;-->

<!--&lt;!&ndash;    const apiKey2 = `${calcResults()}`; // Replace with your API key&ndash;&gt;-->
<!--&lt;!&ndash;    const response = await fetch("https://api.openai.com/v1/chat/completions", {&ndash;&gt;-->
<!--&lt;!&ndash;      method: "POST",&ndash;&gt;-->
<!--&lt;!&ndash;      headers: {&ndash;&gt;-->
<!--&lt;!&ndash;        "Content-Type": "application/json",&ndash;&gt;-->
<!--&lt;!&ndash;        Authorization: `Bearer ${apiKey2}`&ndash;&gt;-->
<!--&lt;!&ndash;      },&ndash;&gt;-->
<!--&lt;!&ndash;      body: JSON.stringify({&ndash;&gt;-->
<!--&lt;!&ndash;        model: "gpt-4o-mini",&ndash;&gt;-->
<!--&lt;!&ndash;        messages: [&ndash;&gt;-->
<!--&lt;!&ndash;          { role: "system", content: `${typePrompt} in the given text.` },&ndash;&gt;-->
<!--&lt;!&ndash;          {&ndash;&gt;-->
<!--&lt;!&ndash;            role: "user",&ndash;&gt;-->
<!--&lt;!&ndash;            content: `Extract ${typePrompt.toLowerCase()} from the following text:\n${inputText}.&ndash;&gt;-->
<!--&lt;!&ndash;                      List each on a separate line. No numbering or punctuation.`&ndash;&gt;-->
<!--&lt;!&ndash;          }&ndash;&gt;-->
<!--&lt;!&ndash;        ],&ndash;&gt;-->
<!--&lt;!&ndash;        max_tokens: 200&ndash;&gt;-->
<!--&lt;!&ndash;      })&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->

<!--&lt;!&ndash;    if (!response.ok) {&ndash;&gt;-->
<!--&lt;!&ndash;      throw new Error(`API error: ${response.statusText}`);&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->

<!--&lt;!&ndash;    const data = await response.json();&ndash;&gt;-->
<!--&lt;!&ndash;    const resultText = data.choices[0]?.message?.content?.trim();&ndash;&gt;-->
<!--&lt;!&ndash;    return resultText ? resultText.split("\n").map(line => line.trim()) : [];&ndash;&gt;-->
<!--&lt;!&ndash;  }&ndash;&gt;-->
<!--&lt;!&ndash;</script>&ndash;&gt;-->
<!--&lt;!&ndash;</html>&ndash;&gt;-->

<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--  <title>Movie Magic - faw109</title>-->
<!--  <style>-->
<!--    body {-->
<!--      font-family: Arial, sans-serif;-->
<!--      margin: 10px;-->
<!--      width: 400px;-->
<!--    }-->
<!--    .hidden {-->
<!--      display: none;-->
<!--    }-->
<!--    #queryInput {-->
<!--      width: calc(100% - 20px);-->
<!--      padding: 10px;-->
<!--      font-size: 14px;-->
<!--      margin-bottom: 10px;-->
<!--    }-->
<!--    #submitQuery {-->
<!--      margin-bottom: 20px;-->
<!--      padding: 10px;-->
<!--      background-color: #0078d7;-->
<!--      color: white;-->
<!--      border: none;-->
<!--      font-size: 14px;-->
<!--      cursor: pointer;-->
<!--    }-->
<!--    #submitQuery:hover {-->
<!--      background-color: #005a9e;-->
<!--    }-->
<!--    .movie-item {-->
<!--      margin-bottom: 5px;-->
<!--    }-->
<!--    button {-->
<!--      margin-top: 10px;-->
<!--    }-->
<!--    .radio-group {-->
<!--      margin-bottom: 10px;-->
<!--    }-->
<!--    .radio-group label {-->
<!--      margin-right: 10px;-->
<!--    }-->
<!--  </style>-->
<!--</head>-->
<!--<body>-->
<!--<h3 id="popupTitle">Movie Magic 0.93</h3>-->
<!--<br>-->
<!--<button id="configureButton">Configure</button>-->

<!--<div class="radio-group">-->
<!--  <label><input type="radio" name="queryType" value="movies" checked> Movies</label>-->
<!--  <label><input type="radio" name="queryType" value="actors"> Actors</label>-->
<!--  <label><input type="radio" name="queryType" value="other"> Other</label>-->
<!--</div>-->

<!--<div id="inputContainer">-->
<!--  <input id="queryInput" type="text" placeholder="Enter text or URL here..." />-->
<!--  <button id="submitQuery">Search</button>-->
<!--</div>-->

<!--<div id="moviesList"></div>-->
<!--<div class="spacer"></div>-->
<!--<br>-->
<!--<button id="getMoreInfo" class="hidden">Get More Info</button>-->
<!--<button id="setAll">Set All</button>-->
<!--<button id="clearAll">Clear All</button>-->
<!--<button id="openMovieTable">Open Movie Table</button>-->
<!--<button id="openActorTable">Open Actor Table</button>-->
<!--</body>-->

<!--<script src="js/util1.js"></script>-->

<!--<script>-->
<!--  document.addEventListener("DOMContentLoaded", () => {-->
<!--    const queryInput = document.getElementById("queryInput");-->
<!--    const submitQuery = document.getElementById("submitQuery");-->
<!--    const moviesList = document.getElementById("moviesList");-->
<!--    const configureButton = document.getElementById("configureButton");-->
<!--    const queryTypeRadios = document.getElementsByName("queryType");-->

<!--    configureButton.addEventListener("click", () => {-->
<!--      chrome.windows.create({-->
<!--        url: "config.html",-->
<!--        type: "popup",-->
<!--        width: 350,-->
<!--        height: 400-->
<!--      });-->
<!--    });-->

<!--    function getSelectedQueryType() {-->
<!--      return [...queryTypeRadios].find(radio => radio.checked)?.value || "movies";-->
<!--    }-->

<!--    async function handleSearch() {-->
<!--      const userQuery = queryInput.value.trim();-->
<!--      const queryType = getSelectedQueryType();-->
<!--      console.log(`Query Type: ${queryType}, Query: ${userQuery}`);-->

<!--      if (!userQuery) {-->
<!--        alert("Please enter a valid query.");-->
<!--        return;-->
<!--      }-->

<!--      let inputText;-->

<!--      if (isValidURL(userQuery)) {-->
<!--        try {-->
<!--          inputText = await fetchTextFromURL(userQuery);-->
<!--          console.log(`inputText; ${inputText}`)-->
<!--        } catch (error) {-->
<!--          alert(`Error fetching URL content: ${error.message}`);-->
<!--          return;-->
<!--        }-->
<!--      } else {-->
<!--        inputText = userQuery;-->
<!--      }-->

<!--      let results;-->
<!--      try {-->
<!--        results = await findTitles(inputText, queryType);-->
<!--      } catch (error) {-->
<!--        alert(`Error fetching titles: ${error.message}`);-->
<!--        return;-->
<!--      }-->

<!--      moviesList.innerHTML = ""; // Clear previous results-->

<!--      if (queryType === "movies") {-->
<!--        buildHtmlMovies(results, moviesList);-->
<!--      } else if (queryType === "actors") {-->
<!--        buildHtmlActors(results, moviesList);-->
<!--      } else if (queryType === "other") {-->
<!--        buildHtmlOthers(results, moviesList); // Placeholder for "Other"-->
<!--      }-->
<!--    }-->

<!--    function isValidURL(string) {-->
<!--      try {-->
<!--        new URL(string);-->
<!--        return true;-->
<!--      } catch (_) {-->
<!--        return false;-->
<!--      }-->
<!--    }-->

<!--    async function fetchTextFromURL(url) {-->
<!--      const response = await fetch(url);-->
<!--      if (!response.ok) {-->
<!--        throw new Error(`Failed to fetch URL: ${response.statusText}`);-->
<!--      }-->
<!--      const text = await response.text();-->
<!--      const doc = new DOMParser().parseFromString(text, "text/html");-->
<!--      const bodyText = doc.body.innerText || "";-->
<!--      return bodyText.substring(0, 12000); // Limit to 1200 characters-->
<!--    }-->

<!--    submitQuery.addEventListener("click", handleSearch);-->
<!--    queryInput.addEventListener("keydown", (event) => {-->
<!--      if (event.key === "Enter") {-->
<!--        handleSearch();-->
<!--      }-->
<!--    });-->
<!--  });-->

<!--  function buildHtmlMovies(movies, moviesList) {-->
<!--    movies.forEach((movie) => {-->
<!--      const item = document.createElement("div");-->
<!--      item.className = "movie-item";-->

<!--      const checkbox = document.createElement("input");-->
<!--      checkbox.type = "checkbox";-->
<!--      checkbox.value = movie;-->

<!--      const link = document.createElement("a");-->
<!--      link.textContent = movie;-->
<!--      link.href = `https://faw987.github.io/faw106.html?title=${movie}&submit=true`;-->
<!--      link.target = "_blank";-->

<!--      item.appendChild(checkbox);-->
<!--      item.appendChild(link);-->
<!--      moviesList.appendChild(item);-->
<!--    });-->
<!--  }-->

<!--  function buildHtmlActors(actors, moviesList) {-->
<!--    actors.forEach((actor) => {-->
<!--      const item = document.createElement("div");-->
<!--      item.className = "movie-item";-->

<!--      const checkbox = document.createElement("input");-->
<!--      checkbox.type = "checkbox";-->
<!--      checkbox.value = actor;-->

<!--      const link = document.createElement("a");-->
<!--      link.textContent = actor;-->
<!--      link.href = `https://faw987.github.io/faw108.html?actor=${actor}&submit=true`;-->
<!--      link.target = "_blank";-->

<!--      item.appendChild(checkbox);-->
<!--      item.appendChild(link);-->
<!--      moviesList.appendChild(item);-->
<!--    });-->
<!--  }-->

<!--  function buildHtmlOthers(others, moviesList) {-->
<!--    others.forEach((other) => {-->
<!--      const item = document.createElement("div");-->
<!--      item.className = "movie-item";-->

<!--      const text = document.createElement("span");-->
<!--      text.textContent = other;-->

<!--      item.appendChild(text);-->
<!--      moviesList.appendChild(item);-->
<!--    });-->
<!--  }-->

<!--  async function findTitles(inputText, type) {-->
<!--    const typePrompt = {-->
<!--      movies: "Identify all movie titles",-->
<!--      actors: "Identify all actor names",-->
<!--      other: "Identify all other related items"-->
<!--    }[type];-->

<!--    const apiKey2 = `${calcResults()}`; // Replace with your API key-->
<!--    const response = await fetch("https://api.openai.com/v1/chat/completions", {-->
<!--      method: "POST",-->
<!--      headers: {-->
<!--        "Content-Type": "application/json",-->
<!--        Authorization: `Bearer ${apiKey2}`-->
<!--      },-->
<!--      body: JSON.stringify({-->
<!--        model: "gpt-4o-mini",-->
<!--        messages: [-->
<!--          { role: "system", content: `${typePrompt} in the given text.` },-->
<!--          {-->
<!--            role: "user",-->
<!--            content: `Extract ${typePrompt.toLowerCase()} from the following text:\n${inputText}.-->
<!--                      List each on a separate line. No numbering or punctuation.`-->
<!--          }-->
<!--        ],-->
<!--        max_tokens: 200-->
<!--      })-->
<!--    });-->

<!--    if (!response.ok) {-->
<!--      throw new Error(`API error: ${response.statusText}`);-->
<!--    }-->

<!--    const data = await response.json();-->
<!--    const resultText = data.choices[0]?.message?.content?.trim();-->
<!--    return resultText ? resultText.split("\n").map(line => line.trim()) : [];-->
<!--  }-->
<!--</script>-->
<!--</html>-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Magic - faw109</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
            width: 400px;
        }

        .hidden {
            display: none;
        }

        #queryInput {
            width: calc(100% - 20px);
            padding: 10px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        #submitQuery {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #0078d7;
            color: white;
            border: none;
            font-size: 14px;
            cursor: pointer;
        }

        #submitQuery:hover {
            background-color: #005a9e;
        }

        .movie-item {
            margin-bottom: 5px;
        }

        button {
            margin-top: 10px;
        }

        .radio-group {
            margin-bottom: 10px;
        }

        .radio-group label {
            margin-right: 10px;
        }

        iframe {
            display: none; /* Hidden iframe for loading the page */
            width: 100%;
            height: 400px;
            border: none;
        }
    </style>
</head>
<body>
<h3 id="popupTitle">Movie Magic 0.93</h3>


<a href="https://margarethamiltonbook.com/" class="grid-item" data-hover="Margaret Hamilton book">Check out this great
    book.</a>


<br>
<button id="configureButton">Configure</button>

<div class="radio-group">
    <label><input type="radio" name="queryType" value="movies" checked> Movies</label>
    <label><input type="radio" name="queryType" value="actors"> Actors</label>
    <label><input type="radio" name="queryType" value="other"> Other</label>
</div>

<div id="inputContainer">
    <input id="queryInput" type="text" placeholder="Enter text or URL here..."/>
    <button id="submitQuery">Search</button>
</div>

<div id="moviesList"></div>
<iframe id="renderFrame"></iframe>
<div class="spacer"></div>
<br>
<button id="getMoreInfo" class="hidden">Get More Info</button>
<button id="setAll">Set All</button>
<button id="clearAll">Clear All</button>
<button id="openMovieTable">Open Movie Table</button>
<button id="openActorTable">Open Actor Table</button>
</body>

<script src="js/util1.js"></script>

<script>

    // if (!localStorage.getItem("bgcolor")) {
    //     populateStorage();
    // } else {
    //     setStyles();
    // }
    //
    // function populateStorage() {
    //     localStorage.setItem("bgcolor", document.getElementById("bgcolor").value);
    //     localStorage.setItem("font", document.getElementById("font").value);
    //     localStorage.setItem("image", document.getElementById("image").value);
    //
    //     setStyles();
    // }
    //
    // function setStyles() {
    //     const currentColor = localStorage.getItem("bgcolor");
    //     const currentFont = localStorage.getItem("font");
    //     const currentImage = localStorage.getItem("image");
    //
    //     document.getElementById("bgcolor").value = currentColor;
    //     document.getElementById("font").value = currentFont;
    //     document.getElementById("image").value = currentImage;
    //
    //     htmlElem.style.backgroundColor = `#${currentColor}`;
    //     pElem.style.fontFamily = currentFont;
    //     imgElem.setAttribute("src", currentImage);
    // }


    const wordCountInput = document.getElementById("wordCountInput");

    // Helper to truncate text to a specific number of words
    function getExcerpt(text, wordLimit) {
        return text.split(/\s+/).slice(0, wordLimit).join(' ') + '...';
    }

    // Populate the list of all tabs with a configurable number of preview words
    function getTabContent(tab) {
        // const listItem = document.createElement("li");
        //
        // // Create a clickable link to focus the original tab
        // const link = document.createElement("a");
        // link.href = "#";
        // link.textContent = `${tab.title || tab.url}`;
        // link.addEventListener("click", (e) => {
        //   e.preventDefault(); // Prevent default anchor behavior
        //
        //   // Activate the original tab
        //   chrome.tabs.update(tab.id, { active: true });
        //
        //   // Focus the window containing the tab
        //   chrome.windows.update(tab.windowId, { focused: true });
        // });
        //
        // listItem.appendChild(link);

        // Fetch and display the body text with the specified word count
        chrome.scripting.executeScript(
            {
                target: {tabId: tab.id},
                func: () => document.body.innerText, // Fetch the body text
            },
            (results) => {
                if (results && results[0]?.result) {
                    const wordLimit = parseInt(wordCountInput.value, 10) || 2000; // Default to 2000 if invalid
                    const excerpt = getExcerpt(results[0].result, wordLimit);

                    // const para = document.createElement("p");
                    // para.textContent = excerpt;
                    // para.className = "preview";
                    // listItem.appendChild(para);
                    return excerpt;
                }
            }
        );

        // tabsList.appendChild(listItem);
    };



    async function fetchBodyText(url) {
        try {
            // Fetch the HTML content of the URL
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            const htmlText = await response.text();

            // Parse the HTML content
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlText, "text/html");

            // Get the inner text of the body
            const bodyText = doc.body.innerText;

            console.log("Body Text:", bodyText);
            return bodyText;
        } catch (error) {
            console.error("Failed to fetch body text:", error);
        }
    }

    // Example usage
    // fetchBodyText("https://www.example.com");



    // Open a new tab with the given URL and extract the first n words of the page
    function openTabAndExtractWords(url, n) {
        // Step 1: Open the tab

        // const url = "https://www.example.com"; // Replace with your desired URL
        const tab = window.open(url, "_blank"); // Opens in a new tab
        if (tab) {
            console.log("New tab created successfully." + `tab: ${tab}`);
        } else {
            console.error("Failed to create a new tab. Popup blocker might be enabled.");
        }

        // chrome.tabs.create({url}, (tab) => {
            const tabId = tab[0].id;
            console.log(`Tab opened with ID: ${tabId}`);

            // Step 2: Wait for the tab to fully load before executing the script
            chrome.tabs.onUpdated.addListener(function listener(tabId, changeInfo) {
                if (tabId === tab.id && changeInfo.status === "complete") {
                    // Remove the listener after the tab is loaded
                    chrome.tabs.onUpdated.removeListener(listener);

                    // Step 3: Inject content script to extract first n words
                    chrome.scripting.executeScript(
                        {
                            target: {tabId: tab.id},
                            func: extractFirstWords,
                            args: [n], // Pass 'n' as an argument
                        },
                        (results) => {
                            if (results && results[0]?.result) {
                                console.log(`First ${n} words of the page:`, results[0].result);
                            } else {
                                console.error("Failed to extract words.");
                            }
                        }
                    );
                }
            });
        // });
    };

    // Content script function to extract first n words from the page
    function extractFirstWords(n) {
        const textContent = document.body.innerText || ""; // Get all text from the page
        const words = textContent.split(/\s+/).filter(Boolean); // Split into words and remove empty entries
        return words.slice(0, n).join(" "); // Return the first n words
    }

    // Example usage: Open a tab and extract the first 10 words
    // openTabAndExtractWords("https://www.example.com", 10);

    document.addEventListener("DOMContentLoaded", () => {
        const queryInput = document.getElementById("queryInput");
        const submitQuery = document.getElementById("submitQuery");
        const moviesList = document.getElementById("moviesList");
        const configureButton = document.getElementById("configureButton");
        const renderFrame = document.getElementById("renderFrame");
        const queryTypeRadios = document.getElementsByName("queryType");

        configureButton.addEventListener("click", () => {
            chrome.windows.create({
                url: "config.html",
                type: "popup",
                width: 350,
                height: 400
            });
        });

        function getSelectedQueryType() {
            return [...queryTypeRadios].find(radio => radio.checked)?.value || "movies";
        }

        async function handleSearch() {
            const userQuery = queryInput.value.trim();
            const queryType = getSelectedQueryType();
            console.log(`Query Type: ${queryType}, Query: ${userQuery}`);

            if (!userQuery) {
                alert("Please enter a valid query.");
                return;
            }

            let inputText;

            if (isValidURL(userQuery)) {
                try {
                  // inputText = await renderAndExtractText(userQuery);
                  // inputText = await openTabAndExtractWords(userQuery,500);
                    inputText = await fetchBodyText(userQuery);
                    // console.log(`Query: ${userQuery}. result: "${inputText}`);
                    // results = await findTitles(inputText, queryType);
                    // results = await findTitles(inputText, 'movies');
                    //
                    // findTitles(inputText, 'movies')
                    //     .then(response => response.text())

                    findTitles(inputText, 'movies').then((resp) => {
                        console.log(`Response:`, resp);
                        // responseText.textContent = resp;
                    });


                    console.log(`results: "${results}`);


                } catch (error) {
                    alert(`Error rendering URL content: ${error.message}`);
                    return;
                }
            } else {
                inputText = userQuery;
            }

            let results;
            try {
                results = await findTitles(inputText, queryType);
            } catch (error) {
                alert(`Error fetching titles: ${error.message}`);
                return;
            }

            moviesList.innerHTML = ""; // Clear previous results

            if (queryType === "movies") {
                buildHtmlMovies(results, moviesList);
            } else if (queryType === "actors") {
                buildHtmlActors(results, moviesList);
            } else if (queryType === "other") {
                buildHtmlOthers(results, moviesList);
            }
        }

        function isValidURL(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        async function renderAndExtractText(url) {
            return new Promise((resolve, reject) => {
                renderFrame.src = url;
                renderFrame.onload = () => {
                    try {
                        const doc = renderFrame.contentDocument || renderFrame.contentWindow.document;
                        const bodyText = Array.from(doc.body.querySelectorAll("*"))
                            .map((el) => el.textContent.trim())
                            .filter((text) => text.length > 0)
                            .join("\n");
                        resolve(bodyText.substring(0, 1200)); // Limit to 1200 characters
                    } catch (error) {
                        reject(new Error("Failed to parse content from the rendered page."));
                    }
                };
                renderFrame.onerror = () => reject(new Error("Failed to load the URL in the iframe."));
            });
        }

        submitQuery.addEventListener("click", handleSearch);
        queryInput.addEventListener("keydown", (event) => {
            if (event.key === "Enter") {
                handleSearch();
            }
        });
    });

    function buildHtmlMovies(movies, moviesList) {
        movies.forEach((movie) => {
            const item = document.createElement("div");
            item.className = "movie-item";

            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.value = movie;

            const link = document.createElement("a");
            link.textContent = movie;
            link.href = `https://faw987.github.io/faw106.html?title=${movie}&submit=true`;
            link.target = "_blank";

            item.appendChild(checkbox);
            item.appendChild(link);
            moviesList.appendChild(item);
        });
    }

    function buildHtmlActors(actors, moviesList) {
        actors.forEach((actor) => {
            const item = document.createElement("div");
            item.className = "movie-item";

            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.value = actor;

            const link = document.createElement("a");
            link.textContent = actor;
            link.href = `https://faw987.github.io/faw108.html?actor=${actor}&submit=true`;
            link.target = "_blank";

            item.appendChild(checkbox);
            item.appendChild(link);
            moviesList.appendChild(item);
        });
    }

    function buildHtmlOthers(others, moviesList) {
        others.forEach((other) => {
            const item = document.createElement("div");
            item.className = "movie-item";

            const text = document.createElement("span");
            text.textContent = other;

            item.appendChild(text);
            moviesList.appendChild(item);
        });
    }

    async function findTitles(inputText, type) {
        const typePrompt = {
            movies: "Identify all movie titles",
            actors: "Identify all actor names",
            other: "Identify all other related items"
        }[type];

        const apiKey2 = `${calcResults()}`; // Replace with your API key
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${apiKey2}`
            },
            body: JSON.stringify({
                model: "gpt-4o-mini",
                messages: [
                    {role: "system", content: `${typePrompt} in the given text.`},
                    {
                        role: "user",
                        content: `Extract ${typePrompt.toLowerCase()} from the following text:\n${inputText}.
                      List each on a separate line. No numbering or punctuation.`
                    }
                ],
                max_tokens: 200
            })
        });

        if (!response.ok) {
            throw new Error(`API error: ${response.statusText}`);
        }

        const data = await response.json();
        const resultText = data.choices[0]?.message?.content?.trim();
        return resultText ? resultText.split("\n").map(line => line.trim()) : [];
    }
</script>
</html>