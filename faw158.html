<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Birthday Candle Blowout â€” Deluxe</title>
    <style>
        :root{
            --bg:#fff7fd;
            --plate:#e6e9f0;
            --cake-crumb:#f9cbd6;      /* side */
            --cake-crumb-2:#f3a8bc;     /* shadow side */
            --cake-top:#ffe6ee;         /* top cake */
            --frost:#ffffff;            /* frosting */
            --jam:#ff6b93;              /* filling stripe */
            --accent:#7a4de9;
            --wick-lit:#d61c4e;
            --wick-out:#111;
            --candle:#ffe08a;
            --candle-stripe:#ffb347;
            --flame-red-outer:#ff6b7d; /* red orb */
            --flame-red-inner:#ff8fa3;
            --text:#3e2a36;
        }

        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            margin:0;display:grid;place-items:center;background:radial-gradient(1200px 600px at 70% -10%,#ffe0fb 0%,transparent 60%),radial-gradient(1000px 500px at -10% 30%,#e8f6ff 0%,transparent 60%),var(--bg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:var(--text);-webkit-tap-highlight-color:transparent;user-select:none
        }

        .card{position:relative;width:min(92vw,820px);aspect-ratio:16/10;background:#ffffffcc;backdrop-filter:blur(6px);border:1px solid #eee5f4;border-radius:24px;box-shadow:0 20px 40px rgba(60,22,72,.12);overflow:hidden}
        header{position:absolute;inset:0 0 auto 0;height:60px;display:flex;align-items:center;justify-content:center;font-weight:700;letter-spacing:.3px;color:var(--accent)}
        #stage{position:absolute;inset:60px 0 0 0;display:grid;place-items:center;height:calc(100% - 60px)}
        svg{width:94%;height:auto;max-height:100%;overflow:visible}

        #confetti{position:absolute;inset:0;pointer-events:none}
        .overlay{position:absolute;inset:0;display:grid;place-items:center;background:rgba(255,255,255,0);pointer-events:none;opacity:0;transition:opacity .4s ease}
        .overlay.show{opacity:1}
        .overlay h2{margin:0;padding:12px 18px;border-radius:16px;background:#ffffffee;border:1px solid #efe6ff;color:var(--accent);font-size:clamp(22px,3.4vw,40px);letter-spacing:.3px;box-shadow:0 20px 40px rgba(122,77,233,.15)}

        .greeting{font:700 clamp(18px,3.4vw,36px)/1 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;fill:var(--accent);text-anchor:middle;filter:drop-shadow(0 3px 5px rgba(122,77,233,.18))}

        /* Candle states */
        .candle{cursor:pointer}
        .candle:focus{outline:none}
        .candle .wick{fill:var(--wick-lit)}
        .candle[aria-pressed="true"] .wick{fill:var(--wick-out)}
        .candle[aria-pressed="true"] .flame-orb{display:none}
        .candle[aria-pressed="true"] .smoke{display:block;animation:poof 500ms ease-out forwards}

        /* Single red/pink orb glow as flame */
        .flame-orb{mix-blend-mode:screen;opacity:.8;animation:orbFlicker 1.1s ease-in-out infinite alternate;filter:drop-shadow(0 0 8px rgba(255,107,125,.6))}

        @keyframes orbFlicker{0%{transform:translateY(0) scale(1);opacity:.55}50%{transform:translateY(-1px) scale(1.06);opacity:.85}100%{transform:translateY(.5px) scale(.98);opacity:.5}}

        /* Smoke poof */
        .smoke{display:none}
        @keyframes poof{0%{opacity:.9;transform:scale(.2) translateY(0)}100%{opacity:0;transform:scale(1.4) translateY(-24px)}}

        .tip{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);font-size:12px;color:#7b6b7f;opacity:.9}
    </style>
</head>
<body>
<div class="card" role="application" aria-label="Birthday candle game">
    <header>Blow out the candles â€” tap each flame âœ¨</header>
    <div id="stage">
        <canvas id="confetti"></canvas>

        <svg viewBox="0 0 900 540" aria-labelledby="title desc" role="img">
            <title id="title">A decorated birthday cake with candles</title>
            <desc id="desc">Tap each candle to blow it out. When all candles are out, you win.</desc>

            <!-- defs: gradients & filters -->
            <defs>
                <radialGradient id="orbRed" cx="50%" cy="35%" r="60%">
                    <stop offset="0%" stop-color="var(--flame-red-inner)" stop-opacity=".9"/>
                    <stop offset="70%" stop-color="var(--flame-red-outer)" stop-opacity=".55"/>
                    <stop offset="100%" stop-color="#fff" stop-opacity="0"/>
                </radialGradient>
                <linearGradient id="sideGrad" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0%" stop-color="var(--cake-crumb)"/>
                    <stop offset="100%" stop-color="var(--cake-crumb-2)"/>
                </linearGradient>
                <linearGradient id="topGrad" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0%" stop-color="#fff"/>
                    <stop offset="100%" stop-color="#ffeef6"/>
                </linearGradient>
                <pattern id="sprinkles" width="16" height="16" patternUnits="userSpaceOnUse">
                    <rect width="16" height="16" fill="transparent"/>
                    <rect x="2" y="2" width="3" height="1.2" fill="#ff8fab"/>
                    <rect x="8" y="5" width="3" height="1.2" fill="#ffd166"/>
                    <rect x="5" y="10" width="3" height="1.2" fill="#7a4de9"/>
                    <rect x="11" y="13" width="3" height="1.2" fill="#00c2a8"/>
                </pattern>
            </defs>

            <!-- Plate -->
            <ellipse cx="450" cy="465" rx="330" ry="38" fill="var(--plate)"/>
            <ellipse cx="450" cy="453" rx="250" ry="18" fill="#000" opacity=".06"/>

            <!-- Fancy two-tier cake -->
            <g id="cake">
                <!-- lower tier side -->
                <rect x="190" y="270" width="520" height="140" rx="28" fill="url(#sideGrad)"/>
                <!-- jam stripe -->
                <rect x="190" y="330" width="520" height="18" rx="9" fill="var(--jam)" opacity=".8"/>
                <!-- lower frosting top edge -->
                <path d="M190 290 h520 v46 c-40 0 -32 28 -60 28 s-32 -28 -60 -28 s-32 28 -60 28 s-32 -28 -60 -28 s-32 28 -60 28 s-32 -28 -60 -28 s-32 28 -60 28 v-46z" fill="var(--frost)"/>

                <!-- upper tier side/top ellipse -->
                <rect x="260" y="210" width="360" height="90" rx="26" fill="#ffe6ee"/>
                <ellipse cx="440" cy="210" rx="180" ry="26" fill="var(--frost)"/>
                <ellipse cx="440" cy="206" rx="175" ry="22" fill="url(#topGrad)"/>
                <!-- frosting puddle with sprinkles -->
                <path d="M260 230 h360 v36 c-28 0 -28 22 -50 22 s-28 -22 -50 -22 s-28 22 -50 22 s-28 -22 -50 -22 s-28 22 -50 22 s-28 -22 -50 -22 v-36z" fill="var(--frost)"/>
                <ellipse cx="440" cy="242" rx="160" ry="14" fill="url(#sprinkles)" opacity=".7"/>
            </g>

            <!-- Candle container -->
            <g id="candleLayer"></g>

            <!-- Greeting BELOW cake -->
            <text id="greeting" class="greeting" x="450" y="520">Happy 8th Birthday</text>
        </svg>

        <div class="overlay" id="overlay" aria-live="polite" aria-atomic="true">
            <h2>ðŸŽ‰ ...and MANY more! ðŸŽ‰</h2>
        </div>

        <div class="tip">Tip: Click or tap a flame to blow it out.</div>
    </div>
</div>

<script>
    // ===== Config =====
    const AGE_NUMBER = 8;   // Printed number
    const CANDLE_COUNT = 8; // How many candles

    // ===== Audio (Web Audio API) =====
    const audio = new (window.AudioContext || window.webkitAudioContext)();
    function playPoof(){
        const duration=.15, bufSize=audio.sampleRate*duration, buf=audio.createBuffer(1,bufSize,audio.sampleRate), data=buf.getChannelData(0);
        for(let i=0;i<bufSize;i++) data[i]=(Math.random()*2-1)*Math.exp(-i/(bufSize*.8));
        const src=audio.createBufferSource(); src.buffer=buf; const filter=audio.createBiquadFilter(); filter.type='highpass'; filter.frequency.value=800; const gain=audio.createGain(); const t=audio.currentTime; gain.gain.setValueAtTime(0.0,t); gain.gain.linearRampToValueAtTime(0.6,t+.02); gain.gain.exponentialRampToValueAtTime(0.001,t+duration); src.connect(filter).connect(gain).connect(audio.destination); src.start();
    }
    function playTada(){
        // keep a small pleasant chord under the final text
        const now=audio.currentTime, notes=[261.63,329.63,392.00]; const gain=audio.createGain(); gain.connect(audio.destination); gain.gain.setValueAtTime(0.001,now); gain.gain.exponentialRampToValueAtTime(0.5,now+.04); gain.gain.exponentialRampToValueAtTime(0.001,now+1.2);
        notes.forEach((f,i)=>{const o=audio.createOscillator(), g=audio.createGain(); o.type='sine'; o.frequency.value=f; o.connect(g).connect(gain); g.gain.setValueAtTime(0.001,now); g.gain.exponentialRampToValueAtTime(0.35/(i+1),now+.05); g.gain.exponentialRampToValueAtTime(0.001,now+1.1); o.start(now); o.stop(now+1.2);});
    }

    // ===== Confetti =====
    const confetti=(function(){
        const canvas=document.getElementById('confetti'); const ctx=canvas.getContext('2d'); let W,H,pieces=[],running=false,start=0;
        function resize(){W=canvas.width=canvas.offsetWidth; H=canvas.height=canvas.offsetHeight;} window.addEventListener('resize',resize); resize();
        function burst(count=140){ pieces=Array.from({length:count},()=>({x:Math.random()*W,y:-10-Math.random()*50,w:6+Math.random()*6,h:8+Math.random()*10,vy:2+Math.random()*3,vx:-1+Math.random()*2,rot:Math.random()*Math.PI,vr:-.2+Math.random()*.4,alpha:1})); start=performance.now(); if(!running){running=true; requestAnimationFrame(tick);} }
        function tick(now){ctx.clearRect(0,0,W,H); const t=(now-start)/1000; pieces.forEach(p=>{p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; p.vy+=.02; p.alpha=Math.max(0,1-t/2.2); ctx.save(); ctx.globalAlpha=p.alpha; ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.fillStyle=`hsl(${(p.x+p.y)%360},90%,60%)`; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore();}); if(t<2.4) requestAnimationFrame(tick); else {running=false; ctx.clearRect(0,0,W,H);} }
        return {burst};
    })();

    // ===== Candles =====
    const candleLayer=document.getElementById('candleLayer');
    const greetingEl=document.getElementById('greeting');
    greetingEl.textContent=`Happy ${AGE_NUMBER}th Birthday`;

    const state={blown:0};

    function createCandle(x,y){
        const NS='http://www.w3.org/2000/svg';
        const g=document.createElementNS(NS,'g'); g.setAttribute('class','candle'); g.setAttribute('tabindex','0'); g.setAttribute('role','button'); g.setAttribute('aria-label','Lit candle â€” click to blow out'); g.setAttribute('aria-pressed','false');

        // stem
        const stem=document.createElementNS(NS,'rect'); stem.setAttribute('x',x-8); stem.setAttribute('y',y-52); stem.setAttribute('width',16); stem.setAttribute('height',52); stem.setAttribute('rx',4); stem.setAttribute('fill','var(--candle)');
        const stripe=document.createElementNS(NS,'path'); stripe.setAttribute('d',`M ${x-9} ${y-46} l 18 10 M ${x-9} ${y-30} l 18 10 M ${x-9} ${y-14} l 18 10`); stripe.setAttribute('stroke','var(--candle-stripe)'); stripe.setAttribute('stroke-width','3');

        // wick
        const wick=document.createElementNS(NS,'rect'); wick.setAttribute('class','wick'); wick.setAttribute('x',x-1); wick.setAttribute('y',y-58); wick.setAttribute('width',2); wick.setAttribute('height',8); wick.setAttribute('rx',1);

        // SINGLE red orb as flame
        const orb=document.createElementNS(NS,'ellipse'); orb.setAttribute('class','flame-orb'); orb.setAttribute('cx',x); orb.setAttribute('cy',y-66); orb.setAttribute('rx',12); orb.setAttribute('ry',16); orb.setAttribute('fill','url(#orbRed)');

        // smoke
        const smoke=document.createElementNS(NS,'circle'); smoke.setAttribute('class','smoke'); smoke.setAttribute('cx',x); smoke.setAttribute('cy',y-66); smoke.setAttribute('r',6); smoke.setAttribute('fill','#c9d2dd'); smoke.setAttribute('opacity','.85');

        g.appendChild(stem); g.appendChild(stripe); g.appendChild(wick); g.appendChild(orb); g.appendChild(smoke);

        function blowOut(){
            if(g.getAttribute('aria-pressed')==='true') return;
            g.setAttribute('aria-pressed','true'); g.setAttribute('aria-label','Candle blown out');
            try{playPoof();}catch{}
            state.blown++; checkWin();
        }
        g.addEventListener('click',blowOut);
        g.addEventListener('keydown',e=>{if(e.key==='Enter'||e.key===' '){e.preventDefault(); blowOut();}});
        return g;
    }



    (function placeCandles(){
        const y=210; const left=300, right=580; const step=(right-left)/(CANDLE_COUNT-1);
        for(let i=0;i<CANDLE_COUNT;i++){const x=Math.round(left+i*step); candleLayer.appendChild(createCandle(x,y));}
    })();

    function checkWin(){
        if(state.blown>=CANDLE_COUNT){ document.getElementById('overlay').classList.add('show'); try{playTada();}catch{} confetti.burst(180); }
    }

    // prime audio on first input (mobile policy)
    function prime(){ if(audio.state==='suspended'){audio.resume();} window.removeEventListener('pointerdown',prime); window.removeEventListener('keydown',prime); }
    window.addEventListener('pointerdown',prime,{once:true}); window.addEventListener('keydown',prime,{once:true});
</script>
</body>
</html>
