<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Birthday Candle Blowout â€” v1.0</title>
    <style>
        :root{
            --bg:#fff7fd;
            --plate:#e6e9f0;
            --cake-crumb:#fff9f4;
            --cake-shadow:#e6d8cf;
            --cake-sprinkle:#ff7ab6;
            --frost:#ffffff;
            --accent:#7a4de9;
            --wick-lit:#d61c4e;
            --wick-out:#111;
            --candle:#ffe08a;
            --candle-stripe:#ffb347;
            --flame-red-outer:#ff6b7d;
            --flame-red-inner:#ff8fa3;
            --text:#3e2a36;
        }

        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            margin:0;display:grid;place-items:center;background:radial-gradient(1200px 600px at 70% -10%,#ffe0fb 0%,transparent 60%),radial-gradient(1000px 500px at -10% 30%,#e8f6ff 0%,transparent 60%),var(--bg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:var(--text);-webkit-tap-highlight-color:transparent;user-select:none
        }

        .card{position:relative;width:min(92vw,820px);height:640px;background:#ffffffcc;backdrop-filter:blur(6px);border:1px solid #eee5f4;border-radius:24px;box-shadow:0 20px 40px rgba(60,22,72,.12);overflow:hidden;display:flex;align-items:center;justify-content:center}
        header{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;justify-content:center;font-weight:700;letter-spacing:.3px;color:var(--accent)}
        #stage{width:100%;height:100%;display:grid;place-items:center;}
        svg{width:94%;height:94%;overflow:visible}

        #confetti{position:absolute;inset:0;pointer-events:none}
        .overlay{position:absolute;inset:0;display:grid;place-items:center;background:rgba(255,255,255,0);pointer-events:none;opacity:0;transition:opacity .4s ease}
        .overlay.show{opacity:1}
        .overlay h2{margin:0;padding:12px 18px;border-radius:16px;background:#ffffffee;border:1px solid #efe6ff;color:var(--accent);font-size:clamp(22px,3.4vw,40px);letter-spacing:.3px;box-shadow:0 20px 40px rgba(122,77,233,.15)}

        .greeting{font:700 clamp(20px,3.6vw,40px)/1.2 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;fill:var(--accent);text-anchor:middle;filter:drop-shadow(0 3px 5px rgba(122,77,233,.18))}
        .countdown{font:600 clamp(18px,3vw,32px)/1.4 ui-sans-serif,system-ui;fill:#ff7ab6;text-anchor:middle;}

        .candle{cursor:pointer}
        .candle .wick{fill:var(--wick-lit)}
        .candle[aria-pressed="true"] .wick{fill:var(--wick-out)}
        .candle[aria-pressed="true"] .flame-orb{display:none}
        .candle[aria-pressed="true"] .smoke{display:block;animation:poof 500ms ease-out forwards}

        .flame-orb{mix-blend-mode:screen;opacity:.8;animation:orbFlicker 1.1s ease-in-out infinite alternate;filter:drop-shadow(0 0 8px rgba(255,107,125,.6))}
        @keyframes orbFlicker{0%{transform:translateY(0) scale(1);opacity:.55}50%{transform:translateY(-1px) scale(1.06);opacity:.85}100%{transform:translateY(.5px) scale(.98);opacity:.5}}

        .smoke{display:none}
        @keyframes poof{0%{opacity:.9;transform:scale(.2) translateY(0)}100%{opacity:0;transform:scale(1.4) translateY(-24px)}}

        .tip{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);font-size:12px;color:#7b6b7f;opacity:.9}
    </style>
</head>
<body>
<div class="card" role="application" aria-label="Birthday candle game">
    <header
            style="
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:2px;
    height:auto;           /* allow two lines */
    padding:8px 0;
    margin:0;
    text-align:center;
  "
    >
        <div style="font-size:28px; line-height:1.2; margin:0;">
            Stella, My belated wishes for another great year ðŸŽ‚
        </div>
        <div style="font-size:12px; line-height:1.2; margin:0;">
            Blow out the candles â€” tap each flame âœ¨
        </div>
    </header>
    <div id="stage">
        <canvas id="confetti"></canvas>

        <svg viewBox="0 0 900 700" aria-labelledby="title desc" role="img">
            <title id="title">Stylized confetti cake with frosting and sprinkles</title>
            <desc id="desc">Tap each candle to blow it out. When all candles are out, you win.</desc>

            <defs>
                <radialGradient id="orbRed" cx="50%" cy="35%" r="60%">
                    <stop offset="0%" stop-color="var(--flame-red-inner)" stop-opacity=".9"/>
                    <stop offset="70%" stop-color="var(--flame-red-outer)" stop-opacity=".55"/>
                    <stop offset="100%" stop-color="#fff" stop-opacity="0"/>
                </radialGradient>
            </defs>

            <ellipse cx="450" cy="640" rx="330" ry="38" fill="var(--plate)"/>

            <g id="cake">
                <rect x="200" y="320" width="500" height="200" rx="20" fill="var(--cake-crumb)" stroke="var(--cake-shadow)" stroke-width="4"/>
                <rect x="200" y="380" width="500" height="24" fill="var(--frost)"/>
                <rect x="200" y="440" width="500" height="24" fill="var(--frost)"/>
                <rect x="200" y="500" width="500" height="24" fill="var(--frost)"/>
                <g>
                    <circle cx="240" cy="340" r="4" fill="var(--cake-sprinkle)"/>
                    <circle cx="300" cy="350" r="4" fill="#00c2a8"/>
                    <circle cx="400" cy="345" r="4" fill="#ffd166"/>
                    <circle cx="520" cy="355" r="4" fill="#7a4de9"/>
                    <circle cx="600" cy="340" r="4" fill="#ff7ab6"/>
                    <circle cx="260" cy="460" r="4" fill="#00c2a8"/>
                    <circle cx="350" cy="470" r="4" fill="#ffd166"/>
                    <circle cx="500" cy="480" r="4" fill="#7a4de9"/>
                </g>
            </g>

            <g id="candleLayer"></g>

            <text id="greeting" class="greeting" x="450" y="560">Happy 7th Birthday</text>
            <text id="countdown" class="countdown" x="450" y="600">7 to go.</text>
        </svg>

        <div class="overlay" id="overlay" aria-live="polite" aria-atomic="true">
            <h2>ðŸŽ‰ ...and MANY more! ðŸŽ‰</h2>
        </div>

        <div class="tip">Tip: Click or tap a flame to blow it out.</div>
    </div>
</div>

<script>
    const AGE_NUMBER = 8;
    const CANDLE_COUNT = 8;

    const audio = new (window.AudioContext || window.webkitAudioContext)();
    function playPoof(){
        const duration=.15, bufSize=audio.sampleRate*duration, buf=audio.createBuffer(1,bufSize,audio.sampleRate), data=buf.getChannelData(0);
        for(let i=0;i<bufSize;i++) data[i]=(Math.random()*2-1)*Math.exp(-i/(bufSize*.8));
        const src=audio.createBufferSource(); src.buffer=buf; const filter=audio.createBiquadFilter(); filter.type='highpass'; filter.frequency.value=800; const gain=audio.createGain(); const t=audio.currentTime; gain.gain.setValueAtTime(0.0,t); gain.gain.linearRampToValueAtTime(0.6,t+.02); gain.gain.exponentialRampToValueAtTime(0.001,t+duration); src.connect(filter).connect(gain).connect(audio.destination); src.start();
    }

    // Improved Option 1: richer synthetic TADA
    // function playTada(){
    //     const now=audio.currentTime;
    //     const chordNotes=[261.63,329.63,392.00,523.25]; // C major chord with high C
    //     const dur=1.5;
    //
    //     chordNotes.forEach((freq,i)=>{
    //         const osc=audio.createOscillator();
    //         const g=audio.createGain();
    //         osc.type='triangle';
    //         osc.frequency.value=freq;
    //         osc.connect(g).connect(audio.destination);
    //
    //         const start=now;
    //         const end=now+dur;
    //         g.gain.setValueAtTime(0.001,start);
    //         g.gain.exponentialRampToValueAtTime(0.4/(i+1),start+0.05);
    //         g.gain.exponentialRampToValueAtTime(0.001,end);
    //
    //         osc.start(start);
    //         osc.stop(end);
    //     });
    //
    //     // Add percussive burst (like a cymbal)
    //     const noiseDur=0.3;
    //     const bufSize=audio.sampleRate*noiseDur;
    //     const buf=audio.createBuffer(1,bufSize,audio.sampleRate);
    //     const data=buf.getChannelData(0);
    //     for(let i=0;i<bufSize;i++){
    //         data[i]=(Math.random()*2-1)*Math.pow(1-i/bufSize,2);
    //     }
    //     const src=audio.createBufferSource();
    //     src.buffer=buf;
    //     const filter=audio.createBiquadFilter();
    //     filter.type='highpass';
    //     filter.frequency.value=1200;
    //     const g=audio.createGain();
    //     g.gain.setValueAtTime(0.5,now);
    //     g.gain.exponentialRampToValueAtTime(0.001,now+noiseDur);
    //     src.connect(filter).connect(g).connect(audio.destination);
    //     src.start(now);
    // }

    const tadaAudio = new Audio("tada.mp3");
    function playTada(){
        tadaAudio.currentTime = 0;
        tadaAudio.play();
    }

    const confetti=(function(){const canvas=document.getElementById('confetti');const ctx=canvas.getContext('2d');let W,H,pieces=[],running=false,start=0;function resize(){W=canvas.width=canvas.offsetWidth;H=canvas.height=canvas.offsetHeight;}window.addEventListener('resize',resize);resize();function burst(count=140){pieces=Array.from({length:count},()=>({x:Math.random()*W,y:-10-Math.random()*50,w:6+Math.random()*6,h:8+Math.random()*10,vy:2+Math.random()*3,vx:-1+Math.random()*2,rot:Math.random()*Math.PI,vr:-.2+Math.random()*.4,alpha:1}));start=performance.now();if(!running){running=true;requestAnimationFrame(tick);}}function tick(now){ctx.clearRect(0,0,W,H);const t=(now-start)/1000;pieces.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.rot+=p.vr;p.vy+=.02;p.alpha=Math.max(0,1-t/2.2);ctx.save();ctx.globalAlpha=p.alpha;ctx.translate(p.x,p.y);ctx.rotate(p.rot);ctx.fillStyle=`hsl(${(p.x+p.y)%360},90%,60%)`;ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);ctx.restore();});if(t<2.4)requestAnimationFrame(tick);else{running=false;ctx.clearRect(0,0,W,H);}}return{burst};})();

    const candleLayer=document.getElementById('candleLayer');
    const greetingEl=document.getElementById('greeting');
    const countdownEl=document.getElementById('countdown');
    greetingEl.textContent=`Happy ${AGE_NUMBER}th Birthday`;
    countdownEl.textContent=`${CANDLE_COUNT} to go.`;

    const state={blown:0};

    function createCandle(x,y){
        const NS='http://www.w3.org/2000/svg';
        const g=document.createElementNS(NS,'g'); g.setAttribute('class','candle'); g.setAttribute('tabindex','0'); g.setAttribute('role','button'); g.setAttribute('aria-label','Lit candle â€” click to blow out'); g.setAttribute('aria-pressed','false');

        const stem=document.createElementNS(NS,'rect'); stem.setAttribute('x',x-8); stem.setAttribute('y',y-52); stem.setAttribute('width',16); stem.setAttribute('height',52); stem.setAttribute('rx',4); stem.setAttribute('fill','var(--candle)');
        const stripe=document.createElementNS(NS,'path'); stripe.setAttribute('d',`M ${x-9} ${y-46} l 18 10 M ${x-9} ${y-30} l 18 10 M ${x-9} ${y-14} l 18 10`); stripe.setAttribute('stroke','var(--candle-stripe)'); stripe.setAttribute('stroke-width','3');

        const wick=document.createElementNS(NS,'rect'); wick.setAttribute('class','wick'); wick.setAttribute('x',x-2); wick.setAttribute('y',y-58); wick.setAttribute('width',6); wick.setAttribute('height',8); wick.setAttribute('rx',2);

        const orb=document.createElementNS(NS,'ellipse'); orb.setAttribute('class','flame-orb'); orb.setAttribute('cx',x+1); orb.setAttribute('cy',y-66); orb.setAttribute('rx',14); orb.setAttribute('ry',18); orb.setAttribute('fill','url(#orbRed)');

        const smoke=document.createElementNS(NS,'circle'); smoke.setAttribute('class','smoke'); smoke.setAttribute('cx',x); smoke.setAttribute('cy',y-66); smoke.setAttribute('r',6); smoke.setAttribute('fill','#c9d2dd'); smoke.setAttribute('opacity','.85');

        g.appendChild(stem); g.appendChild(stripe); g.appendChild(wick); g.appendChild(orb); g.appendChild(smoke);

        function blowOut(){
            if(g.getAttribute('aria-pressed')==='true') return;
            g.setAttribute('aria-pressed','true'); g.setAttribute('aria-label','Candle blown out');
            try{playPoof();}catch{}
            state.blown++;
            countdownEl.textContent=`${CANDLE_COUNT-state.blown} to go.`;
            checkWin();
        }
        g.addEventListener('click',blowOut);
        g.addEventListener('keydown',e=>{if(e.key==='Enter'||e.key===' '){e.preventDefault(); blowOut();}});
        return g;
    }

    (function placeCandles(){
        const y=280; const left=300, right=580; const step=(right-left)/(CANDLE_COUNT-1);
        for(let i=0;i<CANDLE_COUNT;i++){const x=Math.round(left+i*step); candleLayer.appendChild(createCandle(x,y));}
    })();

    function checkWin(){
        if(state.blown>=CANDLE_COUNT){document.getElementById('overlay').classList.add('show');try{playTada();}catch{}confetti.burst(180);}
    }

    function prime(){if(audio.state==='suspended'){audio.resume();}window.removeEventListener('pointerdown',prime);window.removeEventListener('keydown',prime);}
    window.addEventListener('pointerdown',prime,{once:true});window.addEventListener('keydown',prime,{once:true});
</script>
</body>
</html>
